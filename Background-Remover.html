<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Background Remover ‚Äî tools4.fun</title>
<meta name="description" content="Remove background from any image instantly using U¬≤Net AI model directly in your browser. 100% free and offline.">
<link rel="icon" href="favicon-16x16.png" type="image/png">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background: #f8fafc; }
.tool-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  padding: 20px;
  text-align: center;
}
.preview-img {
  max-width: 100%;
  height: auto;
  border-radius: 10px;
  margin-bottom: 10px;
}
.ad-space {
  background: #f9fafb;
  border: 2px dashed #cbd5e1;
  border-radius: 10px;
  text-align: center;
  padding: 20px;
  color: #94a3b8;
}
.spinner {
  display: none;
  margin: 10px auto;
  width: 3rem;
  height: 3rem;
}
</style>
</head>
<body>
<div class="container py-4">
  <h2 class="text-center mb-4 fw-semibold">üñºÔ∏è Background Remover (Offline)</h2>

  <!-- Ad Top -->
  <div class="ad-space mb-4">
    <small>Ad Space (728x90)</small>
  </div>

  <div class="tool-card mx-auto" style="max-width: 800px;">
    <input type="file" id="upload" accept="image/*" class="form-control mb-3">
    <img id="preview" class="preview-img d-none" alt="Preview">
    <div id="spinner" class="spinner-border text-primary" role="status"></div>
    <canvas id="canvas" class="d-none"></canvas>

    <div class="d-flex gap-2 justify-content-center mt-3">
      <button id="removeBtn" class="btn btn-primary">Remove Background</button>
      <button id="downloadBtn" class="btn btn-success d-none">Download PNG</button>
    </div>
  </div>

  <!-- Ad Bottom -->
  <div class="ad-space mt-4">
    <small>Ad Space (728x90)</small>
  </div>
</div>

<!-- U¬≤Net (onnxruntime-wasm) -->
<script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.0/dist/ort.wasm.min.js"></script>
<script>
const upload = document.getElementById('upload');
const preview = document.getElementById('preview');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const spinner = document.getElementById('spinner');
const removeBtn = document.getElementById('removeBtn');
const downloadBtn = document.getElementById('downloadBtn');

let img = new Image();
let model;

async function loadModel() {
  if (!model) {
    model = await ort.InferenceSession.create('https://huggingface.co/briaai/RMBG-1.4/resolve/main/u2netp.onnx');
  }
}

upload.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    img.onload = () => {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
      preview.src = ev.target.result;
      preview.classList.remove('d-none');
      downloadBtn.classList.add('d-none');
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
});

removeBtn.addEventListener('click', async () => {
  if (!img.src) return alert("Please upload an image first!");
  spinner.style.display = "block";
  await loadModel();

  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const input = new ort.Tensor('float32', new Float32Array(imageData.data), [1, 3, canvas.height, canvas.width]);
  const output = await model.run({ input });

  // Simplified background removal logic
  const mask = output[Object.keys(output)[0]].data;
  const outputData = ctx.createImageData(canvas.width, canvas.height);
  for (let i = 0; i < mask.length; i++) {
    const m = mask[i] * 255;
    outputData.data[i * 4 + 0] = imageData.data[i * 4 + 0];
    outputData.data[i * 4 + 1] = imageData.data[i * 4 + 1];
    outputData.data[i * 4 + 2] = imageData.data[i * 4 + 2];
    outputData.data[i * 4 + 3] = m;
  }
  ctx.putImageData(outputData, 0, 0);
  preview.src = canvas.toDataURL('image/png');
  spinner.style.display = "none";
  downloadBtn.classList.remove('d-none');
});

downloadBtn.addEventListener('click', () => {
  const link = document.createElement('a');
  link.download = 'background-removed.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
});
</script>
</body>
</html>
